generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

// 1. 用户表：支持个性化首页
model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String   // 存哈希后的密码
  createdAt DateTime @default(now())

  // 个性化设置：关联到具体的球队和球员
  favoriteTeamId   Int?
  favoriteTeam     Team?   @relation(fields: [favoriteTeamId], references: [id])
  favoritePlayerId Int?
  favoritePlayer   Player? @relation(fields: [favoritePlayerId], references: [id])
}

// 2. 球队表：基础信息
model Team {
  id           Int     @id @default(autoincrement())
  nbaId        Int     @unique // NBA官方API的ID
  name         String  // 例如: Lakers
  fullName     String  // 例如: Los Angeles Lakers
  abbreviation String  // 例如: LAL
  conference   String  // West / East
  division     String? // 分区
  logoUrl      String? // 球队Logo链接
  primaryColor String? // 球队主色调 (Hex格式，如 #552583)

  // 战绩 (每日更新)
  wins    Int   @default(0)
  losses  Int   @default(0)
  winRate Float @default(0.0)
  rank    Int   @default(0) // 分区排名

  players     Player[] // 包含的球员
  fans        User[]   // 关注这只球队的用户
  homeGames   Game[]   @relation("HomeGames") // 作为主队的比赛
  awayGames   Game[]   @relation("AwayGames") // 作为客队的比赛
  seasonStats TeamSeasonStat[] // 赛季统计数据
}

// 球队赛季统计数据
model TeamSeasonStat {
  id       Int    @id @default(autoincrement())
  teamId   Int
  team     Team   @relation(fields: [teamId], references: [id])
  season   String // "2024-25"

  // 战绩数据
  wins     Int   @default(0) // 胜场
  losses   Int   @default(0) // 负场
  winRate  Float @default(0) // 胜率

  // 场均数据
  pts      Float @default(0) // 场均得分
  oppPts   Float @default(0) // 场均失分
  reb      Float @default(0) // 场均篮板
  ast      Float @default(0) // 场均助攻
  stl      Float @default(0) // 场均抢断
  blk      Float @default(0) // 场均盖帽
  tov      Float @default(0) // 场均失误
  fgPct    Float @default(0) // 投篮命中率
  fg3Pct   Float @default(0) // 三分命中率
  ftPct    Float @default(0) // 罚球命中率

  // 效率数据
  offRating Float @default(0) // 进攻效率 (每100回合得分)
  defRating Float @default(0) // 防守效率 (每100回合失分)
  netRating Float @default(0) // 净效率 (进攻效率-防守效率)
  pace      Float @default(0) // 比赛节奏 (每48分钟回合数)

  @@unique([teamId, season])
}

// 3. 球员表：核心资产
model Player {
  id        Int    @id @default(autoincrement())
  nbaId     Int    @unique // NBA官方API的ID
  firstName String
  lastName  String
  fullName  String

  // 静态数据
  height      String?
  weight      String?
  country     String?
  jersey      String?
  position    String?
  headshotUrl String? // 球员高清大头照链接

  // 关系
  teamId Int?
  team   Team? @relation(fields: [teamId], references: [id])
  fans   User[] // 关注这个球员的用户

  // 数据关联
  seasonStats PlayerSeasonStat[]
  gameLogs    PlayerGameLog[]
}

// 4. 球员赛季平均数据 (用于排行榜)
model PlayerSeasonStat {
  id       Int    @id @default(autoincrement())
  playerId Int
  player   Player @relation(fields: [playerId], references: [id])
  season   String // 例如: "2024-25"
  seasonType String @default("Regular Season") // "Regular Season" 或 "Playoffs"

  gamesPlayed Int      // GP - 出场次数
  min         Float?   // MIN - 场均上场时间
  pts         Float    // PTS - 场均得分
  reb         Float    // REB - 场均篮板
  ast         Float    // AST - 场均助攻
  stl         Float    // STL - 场均抢断
  blk         Float    // BLK - 场均盖帽
  tov         Float?   // TOV - 场均失误
  pf          Float?   // PF - 场均犯规
  
  // 投篮数据
  fgm         Float?   // FGM - 场均投篮命中
  fga         Float?   // FGA - 场均投篮出手
  fgPct       Float    // FG_PCT - 投篮命中率
  fg3m        Float?   // FG3M - 场均三分命中
  fg3a        Float?   // FG3A - 场均三分出手
  tppPct      Float    // FG3_PCT - 三分命中率
  ftm         Float?   // FTM - 场均罚球命中
  fta         Float?   // FTA - 场均罚球出手
  ftPct       Float    // FT_PCT - 罚球命中率
  
  // 篮板细分
  oreb        Float?   // OREB - 场均进攻篮板
  dreb        Float?   // DREB - 场均防守篮板
  
  // 高级数据
  eff         Float?   // EFF - 效率值
  astTov      Float?   // AST_TOV - 助攻失误比
  stlTov      Float?   // STL_TOV - 抢断失误比

  updatedAt DateTime @updatedAt
  
  @@unique([playerId, season, seasonType])
}

// 5. 球员单场数据 (用于图表走势分析和今日MVP)
model PlayerGameLog {
  id       Int      @id @default(autoincrement())
  playerId Int
  player   Player   @relation(fields: [playerId], references: [id])
  gameId   String   // 比赛ID
  gameDate DateTime
  matchup  String   // 例如: "LAL vs GSW"
  wl       String   // W or L

  min Int?   // 上场时间（分钟）
  pts Int
  reb Int
  ast Int
  stl Int
  blk Int
  tov Int?   // 失误

  @@index([playerId, gameDate])
}

// 6. 比赛表：存储赛程和比分
model Game {
  id         Int      @id @default(autoincrement())
  gameId     String   @unique // NBA官方的比赛ID
  gameDate   DateTime // 比赛日期 (只存日期部分)
  gameTime   String?  // 比赛开始时间 (如 "7:30 PM ET")
  status     String   // "Scheduled" | "In Progress" | "Final"
  
  // 主队信息
  homeTeamId    Int
  homeTeam      Team   @relation("HomeGames", fields: [homeTeamId], references: [id])
  homeTeamScore Int?   // 主队得分 (比赛结束后才有)
  
  // 客队信息
  awayTeamId    Int
  awayTeam      Team   @relation("AwayGames", fields: [awayTeamId], references: [id])
  awayTeamScore Int?   // 客队得分 (比赛结束后才有)
  
  updatedAt  DateTime @updatedAt
  
  @@index([gameDate]) // 按日期查询优化
}

// 7. 新闻表：存储从 RapidAPI 同步的 NBA 新闻
model News {
  id        Int      @id @default(autoincrement())
  title     String
  url       String
  source    String
  imageUrl  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
